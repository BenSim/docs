<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.2">
<link rel="search" type="application/opensearchdescription+xml" title="CosmWasm Documentation" href="/opensearch.xml"><title data-react-helmet="true">Downloading and Compiling Contract | CosmWasm Documentation</title><meta data-react-helmet="true" property="og:url" content="https://docs.cosmwasm.com/0.14/getting-started/compile-contract"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="0.14"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-0.14"><meta data-react-helmet="true" property="og:title" content="Downloading and Compiling Contract | CosmWasm Documentation"><meta data-react-helmet="true" name="description" content="In this section, we will download a sample contract, compile to it to wasm binary executable."><meta data-react-helmet="true" property="og:description" content="In this section, we will download a sample contract, compile to it to wasm binary executable."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.svg"><link data-react-helmet="true" rel="canonical" href="https://docs.cosmwasm.com/0.14/getting-started/compile-contract"><link data-react-helmet="true" rel="alternate" href="https://docs.cosmwasm.com/0.14/getting-started/compile-contract" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.cosmwasm.com/0.14/getting-started/compile-contract" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.65ab5a88.css">
<link rel="preload" href="/assets/js/runtime~main.54999240.js" as="script">
<link rel="preload" href="/assets/js/main.c7a4d278.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#7691FE;color:#F5F6F7" role="banner"><div class="announcementBarContent_3EUC announcementBarCloseable_3myR">New documentation will be released with CosmWasm 1.0, follow and contribute changes at <a href="https://docs.cosmwasm.com/next">next</a></div><button type="button" class="announcementBarClose_38nx clean-btn" aria-label="Close"><span aria-hidden="true">Ã—</span></button></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://docs.cosmwasm.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img src="/img/logo.svg" alt="CosmWasm" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo_dark.svg" alt="CosmWasm" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/0.14/">0.14</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/next/getting-started/compile-contract">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/0.14/getting-started/compile-contract">0.14</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://cosmwasm.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/CosmWasm" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--checked react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" checked="" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a href="https://docs.cosmwasm.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><img src="/img/logo.svg" alt="CosmWasm" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo_dark.svg" alt="CosmWasm" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://cosmwasm.com" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://github.com/CosmWasm" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/next/getting-started/compile-contract">Next</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/0.14/getting-started/compile-contract">0.14</a></li></ul></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><main class="docMainContainer_3ufF docMainContainerEnhanced_3NYZ"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><span class="badge badge--secondary">Version: 0.14</span><div class="markdown"><header><h1 class="h1Heading_27L5">Downloading and Compiling Contract</h1></header><p>In this section, we will download a sample contract, compile to it to wasm binary executable.</p><p>Please first review the <a href="/0.14/getting-started/setting-env">client setup instructions</a>, and configure and verify a
client, either Go CLI or Node.js console.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="compiling-and-testing-contract"></a>Compiling and Testing Contract<a class="hash-link" href="#compiling-and-testing-contract" title="Direct link to heading">#</a></h2><p>Let&#x27;s download the repo in which we collect
<a href="https://github.com/CosmWasm/cosmwasm-examples" target="_blank" rel="noopener noreferrer"><code>cosmwasm-examples</code></a> and try out an existing simple
escrow contract that can hold some native tokens and gives the power to an arbiter to release them
to a pre-defined beneficiary. First, clone the repo and try to build the wasm bundle:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># get the code</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone https://github.com/CosmWasm/cosmwasm-examples</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> cosmwasm-examples</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> fetch --tags</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> checkout escrow-0.10.0</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> escrow</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># compile the wasm contract with stable toolchain</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rustup default stable</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cargo wasm</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After this compiles, it should produce a file in
<code>target/wasm32-unknown-unknown/release/cw_escrow.wasm</code>. A quick <code>ls -l</code> should show around 2MB. This
is a release build, but not stripped of all unneeded code. To produce a much smaller version, you
can run this which tells the compiler to strip all unused code out:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">RUSTFLAGS</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;-C link-arg=-s&#x27;</span><span class="token plain"> cargo wasm</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This produces a file about 174kB. We use this and another optimizer in the next <a href="#optimized-compilation">last section</a> to produce the final product uploaded to the blockchain. You don&#x27;t need to worry about running this yourself (unless you are
curious), but you should have an idea of the final size of your contract this way.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="unit-tests"></a>Unit Tests<a class="hash-link" href="#unit-tests" title="Direct link to heading">#</a></h2><p>Let&#x27;s try running the unit tests:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">RUST_BACKTRACE</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> cargo unit-test</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After some compilation steps, you should see:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">running 5 tests</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">test contract::tests::cannot_initialize_expired ... ok</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">test contract::tests::proper_initialization ... ok</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">test contract::tests::init_and_query ... ok</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">test contract::tests::handle_refund ... ok</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">test contract::tests::handle_approve ... ok</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">test result: ok. 5 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><code>RUST_BACKTRACE=1</code> will provide you with full stack traces on any error, which is super useful. This
only works for unit tests (which test native rust code, not the compiled wasm). Also, if you want to
know where <code>cargo wasm</code> and <code>cargo unit-test</code> come from, they are just aliases defined in
<code>.cargo/config</code>. Take a look there to understand the cargo flags more.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="optimized-compilation"></a>Optimized Compilation<a class="hash-link" href="#optimized-compilation" title="Direct link to heading">#</a></h2><p>Smart contract binary size must be as small as possible for reduced gas cost. This will not only cost
less on deployment, also for every single interaction. Simply, <strong>optimize production code</strong> using <a href="https://github.com/CosmWasm/rust-optimizer" target="_blank" rel="noopener noreferrer">cosmwasm/rust-optimizer</a>.
<strong>rust-optimizer</strong> also produces reproducible builds of cosmwasm smart contracts.
This means third parties can verify the contract is the actually the claimed code.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker run --rm -v </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">$(</span><span class="token string variable builtin class-name" style="color:rgb(255, 203, 107)">pwd</span><span class="token string variable" style="color:rgb(191, 199, 213)">)</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token plain">:/code </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --mount </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">volume,source</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;$(basename &quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">$(</span><span class="token string variable builtin class-name" style="color:rgb(255, 203, 107)">pwd</span><span class="token string variable" style="color:rgb(191, 199, 213)">)</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">_cache&quot;,target</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/code/target </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --mount </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">type</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">volume,source</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">registry_cache,target</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/usr/local/cargo/registry </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cosmwasm/rust-optimizer:0.11.3</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/CosmWasm/docs/edit/main/versioned_docs/version-0.14/getting-started/compile-contract.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#compiling-and-testing-contract" class="table-of-contents__link">Compiling and Testing Contract</a></li><li><a href="#unit-tests" class="table-of-contents__link">Unit Tests</a></li><li><a href="#optimized-compilation" class="table-of-contents__link">Optimized Compilation</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Related Documentation</div><ul class="footer__items"><li class="footer__item"><a href="https://cosmos.network/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cosmos SDK</a></li><li class="footer__item"><a href="https://hub.cosmos.network/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cosmos Hub</a></li><li class="footer__item"><a href="https://docs.tendermint.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Tendermint Core</a></li></ul></div><div class="col footer__col"><div class="footer__title">Repositories</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/CosmWasm/cosmwasm" target="_blank" rel="noopener noreferrer" class="footer__link-item">CosmWasm/cosmwasm</a></li><li class="footer__item"><a href="https://github.com/CosmWasm/wasmd" target="_blank" rel="noopener noreferrer" class="footer__link-item">CosmWasm/wasmd</a></li><li class="footer__item"><a href="https://github.com/CosmWasm/cosmwasm-plus" target="_blank" rel="noopener noreferrer" class="footer__link-item">CosmWasm/cosmwasm-plus</a></li><li class="footer__item"><a href="https://github.com/CosmWasm/cawesome-wasm" target="_blank" rel="noopener noreferrer" class="footer__link-item">CosmWasm/cawesome-wasm</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://medium.com/cosmwasm" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://docs.cosmwasm.com/chat/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/CosmWasm" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://cosmwasm.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/img/logo_stacked.png" alt="CosmWasm Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/logo_stacked.png" alt="CosmWasm Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2021 Confio OÃœ</div></div></div></footer></div>
<script src="/assets/js/runtime~main.54999240.js"></script>
<script src="/assets/js/main.c7a4d278.js"></script>
</body>
</html>